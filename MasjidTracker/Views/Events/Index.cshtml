@model MasjidTracker.FrontEnd.Models.EventViewModel

@{
    ViewData["Title"] = "Events";
}


<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <script src="https://kit.fontawesome.com/bdd89edb33.js"></script>
    <link rel="manifest" href="/manifest.json" />

    <link rel="stylesheet" href="~/css/events.css" />
    <link rel="manifest" href="/manifest.json" />
    <title>Events</title>
</head>
<body>
 
  <div class = "heading">
    <h2>My Events</h2>
  </div>
   
  <div class="scrolling-wrapper"> 
     @if (Model.UserEvents.Count == 0) {
      <div><i> You are not registered in any events.</i> </div>
    } else {
        @foreach (var item in Model.UserEvents)
        {
          <div class="card">
              @{var colour = "pink";}
              <div class="front">
                @{if (item.OrgId == 1){ // snmc
                  colour = "palevioletred";
                }
                }
                <p style="margin-top: 12px;">
                  <span> <i class="fas fa-mosque" style = "margin: 0; color: @colour; font-size: 1.6rem;"></i> </span> 
                  <span style = "color: @colour; margin:0; font-size: 1.6rem;"> 
                      @{var event_org_string = (EventsOrgEnum)item.OrgId;}
                      @event_org_string
                  </span>
                  <br>
                  <span style="font-size: 1.618rem">@Html.DisplayFor(modelItem => item.Name) </span> <br><br>
                  <span style = "color: black; font-size:small"> 
                      @item.DateTime.ToLongDateString() <br> <br>
                      @item.DateTime.ToShortTimeString()
                  </span> 
                
                </p>
              </div>
              <div class="back">
                <div>
                  <p>Capacity: <span> @Html.DisplayFor(modelItem => item.Capacity) </span></p>
                  <p>Remaining Spots: <span> @{var spots = item.Capacity - item.bookingCount;} @spots </span></p>
                  <p>Hall: <span> @Html.DisplayFor(modelItem => item.Hall) </span></p>
                  <form name="unregisterform" method="post">
                    <div class="form-group">
                      <input type="hidden" id="eventid" name="eventid" value=@item.Id>
                      <input type="submit" value="Unregister" asp-action="Unregister" asp-controller="Events" class="button" />
                    </div>
                  </form>
              </div>
              </div>
            </div>
        } 
      }
  </div> 
 
<br>

  <div class = "heading">
    <h2>All Events</h2>
  </div>

  <div style="margin-left: 18px">
    <p class="description">   
      <form name="filterform" method="post" asp-action="FilterEvents" asp-controller="Events">
        Filter by Organization:
        <select onchange="" id="filter" name="selection" style="border:none;" asp-items="new SelectList(Enum.GetValues(typeof(EventsOrgEnum)))">
          <option value="" selected disabled hidden>@ViewBag.Selected</option>
          <option value="All">All</option>
        </select>
      </form>
    </p>
  </div>

 <hr>

  @foreach (var groupid in Model.GroupedEvents.Keys) // for each group
  {
    <div class="scrolling-wrapper">
    @foreach (var item in Model.GroupedEvents[groupid]) // for each event in the group
    {
    <div class="card" >
        @{var colour = "pink";}
        <div class="front" >
            @{if (item.OrgId == 1){
              colour = "palevioletred";
            }
            }
          <p>
            <span> <i class="fas fa-mosque" style = "margin: 0; color: @colour; font-size: 1.6rem;"></i> </span> 
            <span style = "color: @colour; margin:0; font-size: 1.6rem;"> 
                @{var event_org_string = (EventsOrgEnum)item.OrgId;}
                @event_org_string
            </span>
            <br>
            <span style="font-size: 1.618rem">@Html.DisplayFor(modelItem => item.Name) </span> <br><br>
            <span style = "color: black; font-size:small"> 
                @item.DateTime.ToLongDateString() <br> <br>
                @item.DateTime.ToShortTimeString()
            </span>        
          </p>
        </div>
        <div class="back">
          <div>
              <p>Capacity: <span> @Html.DisplayFor(modelItem => item.Capacity) </span></p>
              <p>Remaining Spots: <span> @{var spots = item.Capacity - item.bookingCount;} @spots </span></p>
              <p>Hall: <span> @Html.DisplayFor(modelItem => item.Hall) </span></p>
            <form name="registerform" method="post">
              <div class="form-group">
                <input type="hidden" id="eventid" name="eventid" value=@item.Id>
                <input type="submit" value="Register" asp-action="Register" asp-controller="Events" class="button" />
              </div>
            </form>
          </div>
        </div>
      </div>
    }
  </div>
  <hr>
}
</div> 

</body>

<script>
  $(document).ready(function() {
    $('#filter').on('change', function() {
      console.log("Hello world");
      document.forms["filterform"].submit();
    });
  });

</script>